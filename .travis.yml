# The language in this case has no bearing - we are going to be making use of "conda" for a
# python distribution for the scientific python stack.
os:
  - linux
  - osx

env:
    global:
        - TARGET_ARCH="x64"
        - secure: "UuKK9DpfwEOEw9vA/OigVdDQP/nC2b2gGr5us2fDBJwfWMPTOOfkQxczuRZ/LDxLGT9ELMyKE6l3lvpoSlJc3gwNtPDiUg5waJvqqqfCVxP0V5etyCDMycge8f8PuvKhb+PgmKmf/xGBBQ9En7B7ES/hpAf5AwBPlJDHqQ/1BytqtnCUVuDCHcIwYdT4HLR/UXwO6y80D4xK/jP4XW3eeOxpMMVgf+5GqWXvSVY3GG4iSwC/Y4veeTBwPxnxEbVAgiMWR9CT0KRSBFXBqDkJLi1kJlp8y2UsOSKt/GE5lOHLjiKyMcSncejCVik4DllmkbQvPWC3p4wUXzfCmcoXWPSYgVbIoGm6VRLtSJCM3S//+tIXHhHIfzN7dj4LRncnx6DEUFuS0OtDh8zxaNaWxL+RtppKp3x89R6Avodt/MYMMOz0+rgYALutpcrLjSI7Q2Qppza3yv3YkAwL0SoztCk6ChBk7xaMRua1QoW0qTW7CFGLI5MzKUKLXA2EGMbYAOsBx4kdG+SKQ742QK/6lcEA0BjaXs6mgNtvyQuaFXzZfnh7ORlMq/W0vF20BV1yNByL3NprtlbocuSfJKEdp6zyrQ4IMxoqXvbXD15oBtXVyQ5XPMbFowZn29WXieW6pNqlL4uneQaMW4/Vgg3XA5K65w/+jYbkWtIFQcDmZwk="
        - CONDA_INSTALL_LOCN="${HOME}/miniconda"

install:
    # Install and set up miniconda.
    - if [ $TRAVIS_OS_NAME == "linux" ]; then wget http://repo.continuum.io/miniconda/Miniconda-latest-Linux-x86_64.sh -O miniconda.sh; fi
    - if [ $TRAVIS_OS_NAME == "osx" ]; then wget http://repo.continuum.io/miniconda/Miniconda-latest-MacOSX-x86_64.sh -O miniconda.sh; fi
    - bash miniconda.sh -b -p $CONDA_INSTALL_LOCN
    - export PATH=${CONDA_INSTALL_LOCN}/bin:$PATH
    - conda config --set always_yes true

    # Gets us vpnotebook
    - conda config --add channels vpython

    - conda update --quiet conda

    # Install a couple of dependencies we need for sure.
    # Not sure why cython is necessary since it is listed as a build dependency.
    - conda install --quiet jinja2 conda-build anaconda-client cython

    - conda install --quiet wheel

script:
    # Not much of a real test yet, just try to build myself...
    - conda build vpython.recipe

    # And try making a wheel
    - python setup.py bdist_wheel

after_success:
    - echo $TRAVIS_TAG
    # Remove line below once conda-build 1.20.3 is released...
    - export CONDA_PACKAGE=`conda build --output vpython.recipe | grep bz2`
    - echo $BINSTAR_TOKEN
    # If this build is because of a tag, upload the build if it succeeds.
    - if [ "$TRAVIS_TAG" ]; then anaconda -t $BINSTAR_TOKEN upload -u vpython $CONDA_PACKAGE; fi
